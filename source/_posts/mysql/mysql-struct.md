---
title: 数据库优化之结构设计
date: 2017-04-15 18:24:35
tags: [mysql,优化]
categories: [后端,mysql]
cover: data:image/jpeg;base64,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
---
## 设计好处 

 - 良好的数据库逻辑设计和物理设计师数据库获得高性能的基础
 - 范式化设计和反范式化设计（减少冗余、减少异常、让数据组织的更加和谐）
 - 优化目的
	 - 减少数据冗余（尽量）
	 - 尽量避免数据维护中出现更新、插入和删除等异常
		 - 插入：如果表中的某个实体随着另一个实体而存在
		 - 更新：如果更改表中的某个实体的单独属性时，需要对多表进行更新
		 - 删除：如果删除表中的某一时则会导致其他实体的消失

------
## 设计过程
- 需求分析
	- 全面了解产品设计的需求	
	- 存储需求（比如一对多，多对一等）
	- 数据处理需求
	- 数据的安全性和完整性
- 逻辑分析
	- 设计数据的逻辑存储结构
	- 数据实体之前的逻辑关系，解决数据冗余和数据维护异常 
- 物理设计
	- 根据所使用数据特点设计表结构
- 维护优化
	- 对索引、存储结构等进行优化 
- 范式化
	-  设计没有数据冗余和数据维护异常的数据库结构
- 反范式化
	-  针对范式化而言的，在前面介绍了数据库设计的范式，所谓的反范式化就是为了性能和读取效率的考虑而适当的对数据库设计范式的要求进行违法，而允许存在少量的数据冗余，换句话来说反范式化就是使用空间来换取时间

> 本篇重点解释物理设计、范式化与反范式化化各自优缺点；其他将在文章《数据库优化》系列一一讲明；

------
## 范式化与反范式化
- 范式化设计的优缺点
	- 优点
		-  尽量减少数据冗余
		- 范式化的更新操作比反范式化更快
		- 范式化的表通常比反范式更小
	- 缺点
		- 对于查询需要对多个表进行关联（mysql限制不能超过10张表）
		- 更难进行索引优化
- 反范式化设计的优缺点
	-  优点
		- 减少表的关联
		- 更好的进行索引优化
	- 缺点
		-  存在数据冗余及数据库维护异常
		- 对数据修改需要更多的成本
		
>  设计范式化要求的三范式：
 第一范式
* 数据库表中的所有字段都只具有单一属性
* 单一属性的列是由基本的数据类型所构成的
* 设计及出来的表都是简单的二维表
第二范式
* 要求一个表中只具有一个业务主键，也就是说符合第二范式的表中不能存在非主键列对只对部分主键的依赖关系
第三范式
*  数据不能存在传递关系，即每个属性都跟主键有直接关系而不是间接关系

---
##物理设计
 - 物理设计的内容
	- 定义数据库、表及字段的命名规范
	- 选择合适的存储引擎
	- 为表中的字段选择合适的数据类型
	- 建立数据库结构 
 - 定义数据库、表及字段的命名规范
	- 可读性原则
	- 表意行原则
	- 长名原则
 - 选择合适的存储引擎

 存储引擎 | 事务|锁粒度|主要应用|忌用
---|---|---|---|---
MyISAM | 不支持|支持并发插入的表级锁|SELECT、INSERT|读写操作频繁
MRG_MYISAM | 不支持|支持并发插入的表级锁|分段归档，数据仓库|全局查找过多的场景
Innodb|支持|支持MVCC的行级锁|事务处理|无
Archive|不支持|行级锁|日志记录，只支持insert，select|需要随机读取，更新，删除
Ndb cluster|支持|行级锁|高可用性|大部分应用

---
- 为表中的字段选择合适的数据类型（数据页）
	- 当一个列可以选择多种数据类型时，应该优先考虑数字类型，其次是日期或二进制类型，最后是字符类型。对于相同级别的数据类型，应该优先选择占用空间小的数据类型
- 如何为Innodb选择主键
	- 主键应该尽可能的小
	- 主键应该是顺序增长的
	- Innodb的主键和业务主键可以不同；

---
